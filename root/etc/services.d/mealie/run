#!/bin/sh
# Mealie s6 service

# Wait for database to be ready (if configured)
if [ -n "$DB_ENGINE" ] && [ "$DB_ENGINE" = "postgres" ]; then
    echo "Waiting for PostgreSQL..."
    until /usr/local/bin/pg_isready -h "${POSTGRES_SERVER:-localhost}" -q 2>/dev/null; do
        sleep 2
    done
    echo "PostgreSQL is ready"
fi

cd /app/mealie

# Run as bsd user using the mealie command (handles migrations internally)
exec /usr/local/bin/s6-setuidgid bsd /opt/mealie/bin/mealie
