#!/bin/sh
# Mealie configuration setup

# Load secrets from *_FILE environment variables (Docker secrets pattern)
# For each FOO_FILE env var, read the file and export FOO
for var in $(env | grep '_FILE=' | cut -d= -f1); do
    base_var="${var%_FILE}"
    file_path="$(eval echo \"\$$var\")"
    if [ -f "$file_path" ]; then
        value="$(cat "$file_path")"
        export "$base_var"="$value"
        echo "Loaded secret for $base_var from $file_path"
    else
        echo "Warning: Secret file $file_path not found for $var"
    fi
done

echo "Setting up Mealie..."

# Create required directories
mkdir -p /config

# Set ownership (bsd:bsd is UID/GID 1000:1000)
chown -R bsd:bsd /config

echo "Mealie configuration complete"
